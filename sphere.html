<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Magical 3D Sphere</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  canvas {
    display: block;
    margin-top: 10px;
  }
  input {
    margin-top: 10px;
  }
</style>
</head>
<body>

<label for="colorPicker" style="color:white;">Pick Sphere Color:</label>
<input type="color" id="colorPicker" value="#00ffff">

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const width = canvas.width;
const height = canvas.height;

let centerX = width / 2;
let centerY = height / 2;

const sphereRadius = Math.min(width, height) / 3;
const particleCount = 100;
const particles = [];

let sphereColor = document.getElementById('colorPicker').value;

// Mouse interaction
let mouseX = centerX;
let mouseY = centerY;
canvas.addEventListener('mousemove', e => {
    mouseX = e.clientX;
    mouseY = e.clientY;
});

// Create random particles on the sphere
for (let i = 0; i < particleCount; i++) {
    const theta = Math.random() * 2 * Math.PI;
    const phi = Math.acos(2 * Math.random() - 1);
    particles.push({ theta, phi });
}

function sphericalToCartesian(r, theta, phi) {
    return {
        x: r * Math.sin(phi) * Math.cos(theta),
        y: r * Math.sin(phi) * Math.sin(theta),
        z: r * Math.cos(phi)
    };
}

function rotateY(point, angle) {
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    return {
        x: point.x * cos - point.z * sin,
        y: point.y,
        z: point.x * sin + point.z * cos
    };
}

function rotateX(point, angle) {
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    return {
        x: point.x,
        y: point.y * cos - point.z * sin,
        z: point.y * sin + point.z * cos
    };
}

let angleX = 0;
let angleY = 0;

// Sphere wander offsets
let wanderX = 0, wanderY = 0;
let wanderAngleX = 0, wanderAngleY = 0;

function animate() {
    // Semi-transparent overlay for smooth trails
    ctx.fillStyle = 'rgba(17,17,17,0.5)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    angleX += 0.014;
    angleY += 0.064;

    // Wander motion
    wanderAngleX += 0.0015;
    wanderAngleY += 0.0015;
    wanderX = Math.sin(wanderAngleX) * width/6;
    wanderY = Math.sin(wanderAngleY) * height/6;

    const projected = particles.map(p => {
        let point = sphericalToCartesian(sphereRadius, p.theta, p.phi);
        point = rotateY(point, angleY);
        point = rotateX(point, angleX);

        // Mouse influence
        const dx = mouseX - (centerX + wanderX + point.x);
        const dy = mouseY - (centerY + wanderY + point.y);
        point.x += dx * 0.001; // adjust intensity of attraction
        point.y += dy * 0.001;

        return point;
    }).sort((a,b) => b.z - a.z);

    for (let p of projected) {
        const scale = 300 / (300 + p.z);
        const x = centerX + wanderX + p.x * scale;
        const y = centerY + wanderY + p.y * scale;
        const radius = 3.0 * scale;

        // Z-depth shading: farther = darker
        const brightness = 0.3 + 0.7 * (1 - (p.z + sphereRadius)/ (2 * sphereRadius));

        // Glowing effect with single color
        const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius * 4);
        gradient.addColorStop(0, `rgba(${parseInt(sphereColor.slice(1,3),16)},${parseInt(sphereColor.slice(3,5),16)},${parseInt(sphereColor.slice(5,7),16)},${brightness})`);
        gradient.addColorStop(0.3, `rgba(${parseInt(sphereColor.slice(1,3),16)},${parseInt(sphereColor.slice(3,5),16)},${parseInt(sphereColor.slice(5,7),16)},${brightness*0.5})`);
        gradient.addColorStop(1, 'rgba(0,0,0,0)');

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
    }

    requestAnimationFrame(animate);
}

animate();

// Color picker
document.getElementById('colorPicker').addEventListener('input', (e)=>{
    sphereColor = e.target.value;
});

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    centerX = canvas.width / 2;
    centerY = canvas.height / 2;
});
</script>
</body>
</html>
