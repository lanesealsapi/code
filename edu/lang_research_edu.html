<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Language Family Tree — Interactive</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220cc;
      --accent:#7dd3fc;
      --muted:#94a3b8;
      --card:#071026e6;
      --glass: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      --glass-2: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.005));
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(125,211,252,0.06), transparent 8%),
        radial-gradient(600px 400px at 90% 90%, rgba(165,180,252,0.03), transparent 6%),
        var(--bg);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      gap:18px;
      padding:20px;
      box-sizing:border-box;
    }

    /* Left visual area */
    #vis {
      flex:1;
      min-width:420px;
      height: calc(100vh - 40px);
      border-radius:14px;
      background:var(--panel);
      padding:12px;
      box-sizing:border-box;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      position:relative;
      overflow:hidden;
    }
    header#visHeader{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:6px;
    }
    header h1{
      font-size:16px;margin:0;color:#dff9ff;
      letter-spacing:0.2px;
    }
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center;}
    .btn{
      background:var(--glass-2);
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
      color:var(--muted);cursor:pointer;font-size:13px;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(90deg, rgba(125,211,252,0.12), rgba(165,180,252,0.06)); color:var(--accent); border-color:rgba(125,211,252,0.08);}
    .search{
      display:flex;align-items:center;background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:10px;gap:6px;border:1px solid rgba(255,255,255,0.02);
    }
    .search input{background:transparent;border:0;color:var(--muted);outline:none;width:160px;font-size:13px}
    /* Sidebar */
    #side {
      width:340px;
      min-width:280px;
      height: calc(100vh - 40px);
      border-radius:14px;background:var(--card);
      padding:14px;box-sizing:border-box;
      display:flex;flex-direction:column;gap:12px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }
    #infoCard{
      background:var(--glass);
      padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);
      min-height:120px;display:flex;flex-direction:column;gap:8px;
    }
    h2{font-size:14px;margin:0;color:#e6f8ff;}
    p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .tag{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}
    footer{margin-top:auto;color:var(--muted);font-size:12px}

    /* tooltip */
    .tooltip{
      position: absolute;
      pointer-events:none;
      background: rgba(2,6,23,0.9);
      color:#d6f7ff;padding:8px 10px;border-radius:8px;font-size:13px;border:1px solid rgba(125,211,252,0.06);
      transform:translate(-50%,-120%);
      white-space:nowrap;display:none;
    }

    /* small responsive adjustments */
    @media (max-width:880px){
      body{flex-direction:column;padding:12px}
      #side{width:100%;height:auto;min-width:0}
      #vis{height:60vh;min-width:0}
    }
  </style>
</head>
<body>

  <div id="vis" aria-label="Language family tree visualization">
    <header id="visHeader">
      <h1>Language Family Tree</h1>
      <div class="controls">
        <div class="search" title="Search languages">
          <svg width="14" height="14" viewBox="0 0 20 20" fill="none"><path d="M19 19l-4.35-4.35" stroke="#85c6dd" stroke-width="1.4" stroke-linecap="round"/><circle cx="9" cy="9" r="6.2" stroke="#85c6dd" stroke-width="1.4" /></svg>
          <input id="search" placeholder="Search language..." />
        </div>
        <button id="layoutBtn" class="btn">Radial</button>
        <button id="resetBtn" class="btn primary">Reset</button>
      </div>
    </header>

    <svg id="svg" width="100%" height="100%"></svg>

    <div class="tooltip" id="tooltip"></div>
  </div>

  <aside id="side">
    <div id="infoCard">
      <h2 id="nodeTitle">Select a node</h2>
      <p id="nodeDesc">Click any node to view family, branch, and a sample word with translation.</p>
      <div class="meta" id="nodeMeta"></div>
    </div>

    <div id="controlsCard" style="background:var(--glass-2);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)">
      <p style="margin:0;color:var(--muted);font-size:13px">Options</p>
      <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
        <button id="toggleLabels" class="btn">Toggle Labels</button>
        <button id="collapseBtn" class="btn">Collapse/Expand</button>
      </div>
    </div>

    <footer>
      Built lightweight · Data is editable inside the script · Icons & theme inspired by modern dashboards.
    </footer>
  </aside>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script>
    // ========= Editable data: simple language family tree =========
    // Each node: name, family, branch, sample (word:translation), note
    const data = {
      name: "Proto-Indo-European",
      family: "Indo-European (Proto)",
      note: "Hypothetical ancestor",
      children: [
        {
          name: "Germanic",
          family: "Indo-European",
          children: [
            { name: "Old Norse", family: "Germanic", sample: {word:"vinr",gloss:"friend"} },
            { name: "West Germanic", family: "Germanic", children: [
                { name: "English", family:"Germanic", branch:"West", sample:{word:"water",gloss:"water"} },
                { name: "German", family:"Germanic", branch:"West", sample:{word:"Wasser",gloss:"water"} },
                { name: "Dutch", family:"Germanic", branch:"West", sample:{word:"water",gloss:"water"} }
              ]
            }
          ]
        },
        {
          name: "Italic",
          family: "Indo-European",
          children: [
            { name: "Latin", family:"Italic", sample:{word:"pater",gloss:"father"} },
            { name: "Romance", family:"Italic", children:[
                { name: "Spanish", family:"Romance", sample:{word:"agua",gloss:"water"} },
                { name: "French", family:"Romance", sample:{word:"eau",gloss:"water"} },
                { name: "Italian", family:"Romance", sample:{word:"acqua",gloss:"water"} }
              ]
            }
          ]
        },
        {
          name: "Balto-Slavic",
          family: "Indo-European",
          children:[
            { name:"Slavic", family:"Balto-Slavic", children:[
                { name:"Russian", family:"Slavic", sample:{word:"вода",gloss:"water"} },
                { name:"Polish", family:"Slavic", sample:{word:"woda",gloss:"water"} }
              ]
            },
            { name:"Lithuanian", family:"Balto-Slavic", sample:{word:"vanduo",gloss:"water"} }
          ]
        },
        {
          name: "Indo-Iranian",
          family: "Indo-European",
          children:[
            { name:"Sanskrit", family:"Indo-Iranian", sample:{word:"जल (jala)",gloss:"water"} },
            { name:"Hindi", family:"Indo-Iranian", sample:{word:"पानी (pānī)",gloss:"water"} },
            { name:"Persian", family:"Indo-Iranian", sample:{word:"آب (âb)",gloss:"water"} }
          ]
        }
      ]
    };

    // ========= Setup SVG + groups =========
    const svg = d3.select("#svg");
    const width = document.getElementById('vis').clientWidth - 24;
    const height = document.getElementById('vis').clientHeight - 72;
    svg.attr("viewBox", [-width/2, -height/2, width, height]);

    const gLinks = svg.append("g").attr("id","links");
    const gNodes = svg.append("g").attr("id","nodes");

    // Zoom & pan
    svg.call(d3.zoom().scaleExtent([0.4, 4]).on("zoom", (event) => {
      gLinks.attr("transform", event.transform);
      gNodes.attr("transform", event.transform);
    }));

    // Tooltip
    const tooltip = d3.select("#tooltip");

    // Convert to hierarchy and initial layout type
    let root = d3.hierarchy(data);
    root.x0 = 0; root.y0 = 0;
    let radial = true;
    let showLabels = true;

    // Pre-collapse deeper nodes for cleaner view
    root.children.forEach(c => { if (c.children) c._children = c.children; c.children = null; });

    function update(source) {
      // layout
      const radius = Math.min(width, height) / 2 - 40;
      let treeLayout;
      if (radial) {
        treeLayout = d3.tree().size([2 * Math.PI, radius]);
        treeLayout(root);
      } else {
        treeLayout = d3.tree().size([height - 120, width - 200]);
        treeLayout(root);
      }

      // compute nodes/links
      const nodes = root.descendants();
      const links = root.links();

      // convert node positions (radial vs vertical)
      nodes.forEach(d => {
        if (radial) {
          const r = d.y;
          const a = d.x - Math.PI / 2;
          d.cx = r * Math.cos(a);
          d.cy = r * Math.sin(a);
        } else {
          d.cx = d.y - width/2 + 60;
          d.cy = d.x - height/2 + 60;
        }
      });

      // LINKS
      const linkSel = gLinks.selectAll("path.link").data(links, d => d.target.data.name);
      linkSel.join(
        enter => enter.append("path")
          .attr("class","link")
          .attr("fill","none")
          .attr("stroke","rgba(125,211,252,0.12)")
          .attr("stroke-width",1.6)
          .attr("d", d => {
            const s = {cx: source.cx ?? 0, cy: source.cy ?? 0};
            return diagonal(s, s);
          })
          .call(enter => enter.transition().duration(450).attr("d", d => diagonal(d.source, d.target))),
        update => update.call(u => u.transition().duration(450).attr("d", d => diagonal(d.source, d.target))),
        exit => exit.call(e => e.transition().duration(350).attr("d", d => diagonal(source, source)).remove())
      );

      // NODES
      const nodeSel = gNodes.selectAll("g.node").data(nodes, d => d.data.name);
      const nodeEnter = nodeSel.join(
        enter => {
          const g = enter.append("g").attr("class","node").attr("transform", d => `translate(${source.cx ?? 0},${source.cy ?? 0})`).style("cursor","pointer");
          g.append("circle")
            .attr("r", 1e-6)
            .attr("fill", d => d._children ? "rgba(125,211,252,0.22)" : "rgba(255,255,255,0.02)")
            .attr("stroke", d => d._children ? "#7dd3fc" : "rgba(125,211,252,0.12)")
            .attr("stroke-width", 1.4);

          g.append("text")
            .attr("dy", "0.32em")
            .attr("x", 10)
            .attr("fill", "#dff9ff")
            .style("font-size","12px")
            .style("pointer-events","none")
            .text(d => showLabels ? d.data.name : "");

          g.on("click", (event, d) => { toggle(d); update(d); showNodeInfo(d); })
           .on("mouseover", (event, d) => {
              tooltip.style("display","block")
                .style("left", (event.pageX - document.getElementById('vis').getBoundingClientRect().left) + "px")
                .style("top", (event.pageY - document.getElementById('vis').getBoundingClientRect().top) + "px")
                .html(`<strong>${d.data.name}</strong>`);
           })
           .on("mousemove", (event) => {
             tooltip.style("left", (event.pageX - document.getElementById('vis').getBoundingClientRect().left) + "px")
                    .style("top", (event.pageY - document.getElementById('vis').getBoundingClientRect().top - 12) + "px");
           })
           .on("mouseout", () => tooltip.style("display","none"));

          return g;
        },
        update => update,
        exit => exit.call(e => e.remove())
      );

      // transition nodes to their new positions
      nodeSel.select("circle").transition().duration(450)
        .attr("r", d => 6 + (d.depth ? Math.max(0, 5 - d.depth) : 6))
        .attr("fill", d => d._children ? "rgba(125,211,252,0.22)" : "rgba(255,255,255,0.02)")
        .attr("stroke", d => d._children ? "#7dd3fc" : "rgba(125,211,252,0.12)");

      nodeSel.transition().duration(450).attr("transform", d => `translate(${d.cx},${d.cy})`);

      nodeSel.select("text").text(d => showLabels ? d.data.name : "");

      // helper diagonal
      function diagonal(s, t){
        if (radial) {
          const sa = Math.atan2(s.cy, s.cx);
          const ta = Math.atan2(t.cy, t.cx);
          const sr = Math.sqrt(s.cx*s.cx + s.cy*s.cy);
          const tr = Math.sqrt(t.cx*t.cx + t.cy*t.cy);
          const c0 = project(sa, sr);
          const c1 = project( (sa+ta)/2, (sr+tr)/2 );
          const c2 = project(ta, tr);
          return `M${c0.x},${c0.y} C${c1.x},${c1.y} ${c1.x},${c1.y} ${c2.x},${c2.y}`;
        } else {
          return `M${s.cx},${s.cy}C${(s.cx+t.cx)/2},${s.cy} ${(s.cx+t.cx)/2},${t.cy} ${t.cx},${t.cy}`;
        }
      }
      function project(angle, radius){ return {x: radius*Math.cos(angle), y: radius*Math.sin(angle)}; }
    } // end update

    function toggle(d){
      if (d.children){ d._children = d.children; d.children = null; }
      else if (d._children){ d.children = d._children; d._children = null; }
    }

    function showNodeInfo(d){
      const title = document.getElementById("nodeTitle");
      const desc = document.getElementById("nodeDesc");
      const meta = document.getElementById("nodeMeta");
      title.textContent = d.data.name;
      const family = d.data.family ?? (d.parent && d.parent.data.family) ?? "—";
      desc.textContent = d.data.note ? d.data.note : (d.data.sample ? `Sample: "${d.data.sample.word}" — ${d.data.sample.gloss}` : "No extra notes.");
      meta.innerHTML = '';
      const tags = [
        ["Family", family],
        ["Branch", d.data.branch ?? (d.parent && d.parent.data.name) ?? "—"],
        ["Depth", d.depth]
      ];
      tags.forEach(t => {
        const el = document.createElement("div");
        el.className = "tag";
        el.textContent = `${t[0]}: ${t[1]}`;
        meta.appendChild(el);
      });
    }

    // initial render
    update(root);

    // Controls
    document.getElementById("layoutBtn").addEventListener("click", () => {
      radial = !radial;
      document.getElementById("layoutBtn").textContent = radial ? "Radial" : "Vertical";
      update(root);
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      // restore collapse
      root.children.forEach(c => { if (c._children) { c.children = null; } if (c.children) c._children = c.children; c.children = null; });
      showLabels = true;
      document.getElementById("toggleLabels").textContent = "Toggle Labels";
      update(root);
      // reset view transform
      svg.transition().duration(350).call( d3.zoom().transform, d3.zoomIdentity );
    });

    document.getElementById("toggleLabels").addEventListener("click", () => {
      showLabels = !showLabels;
      document.getElementById("toggleLabels").textContent = showLabels ? "Hide Labels" : "Show Labels";
      update(root);
    });

    document.getElementById("collapseBtn").addEventListener("click", () => {
      // toggle collapse: collapse all if any expanded; else expand one level
      const anyExpanded = root.descendants().some(n => n.children && n.depth>0);
      if (anyExpanded) {
        root.descendants().forEach(n => { if (n.children) { n._children = n.children; n.children = null; } });
      } else {
        root.children.forEach(c => { if (c._children) { c.children = c._children; c._children = null; } });
      }
      update(root);
    });

    // search
    const searchInput = document.getElementById("search");
    let lastSearch = "";
    searchInput.addEventListener("input", (e) => {
      const v = e.target.value.trim().toLowerCase();
      if (!v) { clearHighlights(); lastSearch=""; return;}
      if (v === lastSearch) return;
      lastSearch = v;
      const matches = root.descendants().filter(n => n.data.name.toLowerCase().includes(v));
      clearHighlights();
      if (matches.length) {
        matches.forEach(m => {
          // expand path to root
          let p = m;
          while (p) { if (p._children) { p.children = p._children; p._children = null; } p = p.parent; }
        });
        update(root);
        // highlight matched nodes
        setTimeout(() => {
          gNodes.selectAll("g.node").select("circle")
            .attr("stroke-width", d => matches.includes(d) ? 2.6 : 1.4)
            .attr("stroke", d => matches.includes(d) ? "#ffd88a" : (d._children ? "#7dd3fc" : "rgba(125,211,252,0.12)"));
        }, 420);
      }
    });

    function clearHighlights(){
      gNodes.selectAll("g.node").select("circle")
        .attr("stroke-width",1.4)
        .attr("stroke", d => d._children ? "#7dd3fc" : "rgba(125,211,252,0.12)");
    }

    // resize handling
    window.addEventListener("resize", () => {
      const w = document.getElementById('vis').clientWidth - 24;
      const h = document.getElementById('vis').clientHeight - 72;
      svg.attr("viewBox", [-w/2, -h/2, w, h]);
      update(root);
    });

    // small UX: click blank area to deselect
    svg.on("click", (event) => {
      if (event.target.tagName === 'svg') {
        document.getElementById("nodeTitle").textContent = "Select a node";
        document.getElementById("nodeDesc").textContent = "Click any node to view family, branch, and a sample word with translation.";
        document.getElementById("nodeMeta").innerHTML = "";
      }
    });

    // initial sample info
    showNodeInfo(root);
  </script>
</body>
</html>
