<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Coral Reef Smooth</title>
<style>
  body { margin: 0; overflow: hidden; background: #01011a; cursor: crosshair; font-family: sans-serif;}
  canvas { display: block; }

  /* Toggle switch */
  .toggle-container {
    position: absolute;
    top: 20px; left: 20px;
    display: flex; align-items: center; gap: 10px;
    z-index: 10;
    color: white;
    font-weight: bold;
  }
  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
  }
  .switch input { display:none; }
  .slider {
    position: absolute;
    cursor: pointer;
    top:0; left:0; right:0; bottom:0;
    background-color: #111;
    border-radius: 34px;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content:"";
    height: 20px; width: 20px;
    left: 2px; bottom: 2px;
    background-color: #fff;
    border-radius: 50%;
    transition: .4s;
  }
  input:checked + .slider {
    background-color: #555;
  }
  input:checked + .slider:before {
    transform: translateX(26px);
  }
</style>
</head>
<body>
<div class="toggle-container">
  Neon Theme
  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider"></span>
  </label>
</div>
<canvas id="reef"></canvas>

<script>
const canvas = document.getElementById('reef');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// Mouse position
let mouse = {x: canvas.width/2, y: canvas.height/2};
window.addEventListener('mousemove', e => mouse = {x:e.clientX, y:e.clientY});

// Theme toggle
let neonTheme = 0; // 0 = purple/cyan, 1 = orange/green
document.getElementById('themeToggle').addEventListener('change', e=>{
  neonTheme = e.target.checked ? 1 : 0;
  createObjects(); // refresh colors
});

// Utility
function rand(min, max) { return Math.random()*(max-min)+min; }
function dist(x1,y1,x2,y2) { return Math.hypot(x2-x1,y2-y1); }

// Coral class (smooth sway)
class Coral {
  constructor(x,y,z,color,height){
    this.x=x; this.y=y; this.z=z; this.color=color; this.height=height; this.offset=Math.random()*Math.PI*2;
  }
  draw(time){
    let scale = 1/(this.z/500 + 1);
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.scale(scale, scale);
    ctx.strokeStyle = this.color;
    ctx.lineWidth = 3;
    ctx.shadowBlur = 20*scale;
    ctx.shadowColor = this.color;
    ctx.beginPath();
    let sway = Math.sin(time*0.001 + this.offset)*8 + Math.sin(time*0.003 + this.offset*2)*2;
    ctx.moveTo(0,0);
    ctx.bezierCurveTo(sway, -this.height/2, -sway, -this.height/2, 0, -this.height);
    ctx.stroke();
    ctx.restore();
  }
}

// Plant class (smooth sway)
class Plant {
  constructor(x,y,z,color,height){
    this.x=x; this.y=y; this.z=z; this.color=color; this.height=height; this.offset=Math.random()*Math.PI*2;
  }
  draw(time){
    let scale = 1/(this.z/500 + 1);
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.scale(scale,scale);
    ctx.strokeStyle=this.color;
    ctx.lineWidth=2;
    ctx.shadowBlur=15*scale;
    ctx.shadowColor=this.color;
    ctx.beginPath();
    let sway = Math.sin(time*0.001 + this.offset)*6 + Math.sin(time*0.003 + this.offset*2)*2;
    ctx.moveTo(0,0);
    ctx.quadraticCurveTo(sway, -this.height/2, 0, -this.height);
    ctx.stroke();
    ctx.restore();
  }
}

// Fish with tail
class Fish {
  constructor(){
    this.x=rand(0,canvas.width);
    this.y=rand(0,canvas.height*0.7);
    this.z=rand(0,500);
    this.size=rand(5,15);
    this.color = neonTheme===0 ? `hsl(${rand(180,300)},100%,60%)` : `hsl(${rand(20,60)},100%,60%)`;
    this.speed=rand(0.5,2);
    this.angle=Math.random()*Math.PI*2;
    this.tailOffset=Math.random()*Math.PI*2;
  }
  update(){
    this.x += Math.cos(this.angle)*this.speed;
    this.y += Math.sin(this.angle)*this.speed;
    let d = dist(this.x,this.y,mouse.x,mouse.y);
    if(d<150){
      this.angle = Math.atan2(this.y-mouse.y, this.x-mouse.x);
    } else {
      this.angle += rand(-0.02,0.02);
    }
    if(this.x<0) this.x=canvas.width;
    if(this.x>canvas.width) this.x=0;
    if(this.y<0) this.y=canvas.height;
    if(this.y>canvas.height) this.y=0;
  }
  draw(time){
    let scale = 1/(this.z/500 + 1);
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.scale(scale,scale);
    ctx.rotate(this.angle);

    // Body
    ctx.fillStyle=this.color;
    ctx.shadowBlur=15*scale;
    ctx.shadowColor=this.color;
    ctx.beginPath();
    ctx.ellipse(0,0,this.size*1.5,this.size,0,0,Math.PI*2);
    ctx.fill();

    // Tail
    let tailWiggle = Math.sin(time*0.01 + this.tailOffset)*this.size;
    ctx.beginPath();
    ctx.moveTo(-this.size*1.5,0);
    ctx.lineTo(-this.size*2.5, tailWiggle);
    ctx.lineTo(-this.size*2.5, -tailWiggle);
    ctx.closePath();
    ctx.fill();

    ctx.restore();
  }
}

// Particle
class Particle {
  constructor(){
    this.x=rand(0,canvas.width);
    this.y=rand(0,canvas.height);
    this.z=rand(0,500);
    this.radius=rand(1,3);
    this.color=`hsl(180,100%,${rand(50,80)}%)`;
    this.speed=rand(0.1,0.5);
  }
  update(){ this.y -= this.speed; if(this.y<0) this.y=canvas.height; }
  draw(){ 
    let scale = 1/(this.z/500+1);
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.scale(scale,scale);
    ctx.fillStyle=this.color;
    ctx.shadowBlur=20*scale;
    ctx.shadowColor=this.color;
    ctx.beginPath();
    ctx.arc(0,0,this.radius,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }
}

// Initialize objects
let corals=[], plants=[], fishes=[], particles=[];
function createObjects(){
  corals=[]; plants=[]; fishes=[]; particles=[];
  for(let i=0;i<30;i++) corals.push(new Coral(rand(50,canvas.width-50), canvas.height, rand(0,500), neonTheme===0 ? `hsl(${rand(200,300)},100%,60%)` : `hsl(${rand(20,60)},100%,60%)`, rand(50,150)));
  for(let i=0;i<50;i++) plants.push(new Plant(rand(0,canvas.width), canvas.height, rand(0,500), neonTheme===0 ? `hsl(${rand(160,220)},100%,50%)` : `hsl(${rand(80,140)},100%,50%)`, rand(50,120)));
  for(let i=0;i<25;i++) fishes.push(new Fish());
  for(let i=0;i<150;i++) particles.push(new Particle());
}
createObjects();

// Animate
function animate(time=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let allObjects = [...corals, ...plants, ...fishes, ...particles];
  allObjects.sort((a,b)=>b.z - a.z);
  allObjects.forEach(obj=>{
    if(obj.update) obj.update();
    obj.draw(time);
  });
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
