<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Moon Orbit Simulator</title>
<style>
  body { margin:0; overflow:hidden; background:black; font-family:sans-serif; color:white; }
  svg { display:block; width:100vw; height:100vh; background:black; }
  #message {
    position:absolute; top:20px; left:50%; transform:translateX(-50%);
    font-size:24px; text-align:center;
  }
</style>
</head>
<body>
<div id="message">Orbit the Moon! ‚Üë‚Üì pitch, ‚Üê‚Üí yaw, Space thrust.</div>
<svg id="canvas"></svg>

<script>
// Canvas and dimensions
const svg = document.getElementById('canvas');
const width = window.innerWidth;
const height = window.innerHeight;

// Helper to create SVG element
function create(tag, attrs){
  const el = document.createElementNS("http://www.w3.org/2000/svg",tag);
  for(let k in attrs) el.setAttribute(k, attrs[k]);
  svg.appendChild(el);
  return el;
}

// Stars
for(let i=0;i<500;i++){
  create("circle",{cx:Math.random()*width, cy:Math.random()*height, r:Math.random()*1.5, fill:"white"});
}

// Moon with craters
const moon = create("circle",{cx:width/2, cy:100, r:80, fill:"#dcdcdc"});
for(let i=0;i<30;i++){
  create("circle",{cx:width/2 + Math.random()*120-60, cy:100 + Math.random()*120-60, r:Math.random()*10, fill:"#aaa", opacity:0.6});
}

// Earth in background
const earth = create("circle",{cx:width-150, cy:height-150, r:60, fill:"#2a7fff"});
for(let i=0;i<30;i++){
  create("circle",{cx:width-150 + Math.random()*100-50, cy:height-150 + Math.random()*100-50, r:Math.random()*5, fill:"#1a5fbb"});
}

// Rocket
let rocket = {x:width/2, y:height-200, vx:0, vy:-1, angle:0, yaw:0, angularVelocity:0, yawVelocity:0, thrusting:false, fuel:100};

// Rocket trail
let trail = [];

// Rocket body SVG
const rocketGroup = create("g",{});
const mainBody = create("rect",{x:-5, y:-20, width:10, height:30, rx:3, ry:3, fill:"#ccc"});
const nose = create("polygon",{points:"0,-20 5,-30 10,-20", fill:"#aaa"});
const leftWing = create("polygon",{points:"-5,0 -15,10 0,10", fill:"#f00"});
const rightWing = create("polygon",{points:"5,0 15,10 0,10", fill:"#f00"});
rocketGroup.appendChild(mainBody);
rocketGroup.appendChild(nose);
rocketGroup.appendChild(leftWing);
rocketGroup.appendChild(rightWing);

// Flames
let flames=[];
for(let i=0;i<15;i++) flames.push(create("circle",{r:Math.random()*3+1, fill:"orange"}));

// Input
let keys={left:false,right:false,up:false,down:false,space:false};
document.addEventListener('keydown',e=>{
  if(e.key==="ArrowLeft") keys.left=true;
  if(e.key==="ArrowRight") keys.right=true;
  if(e.key==="ArrowUp") keys.up=true;
  if(e.key==="ArrowDown") keys.down=true;
  if(e.key===" ") keys.space=true;
});
document.addEventListener('keyup',e=>{
  if(e.key==="ArrowLeft") keys.left=false;
  if(e.key==="ArrowRight") keys.right=false;
  if(e.key==="ArrowUp") keys.up=false;
  if(e.key==="ArrowDown") keys.down=false;
  if(e.key===" ") keys.space=false;
});

// Physics constants
const gravity = 0.05;
const thrustPower = 0.12;
const torque = 0.003;

// Animation loop
function update(){
  // Controls
  if(keys.left) rocket.yawVelocity -= torque;
  if(keys.right) rocket.yawVelocity += torque;
  if(keys.up) rocket.angularVelocity -= torque;
  if(keys.down) rocket.angularVelocity += torque;
  rocket.thrusting = keys.space && rocket.fuel>0;

  // Rotation update
  rocket.angle += rocket.angularVelocity;
  rocket.yaw += rocket.yawVelocity;
  rocket.angularVelocity *= 0.98;
  rocket.yawVelocity *= 0.98;

  // Thrust
  if(rocket.thrusting){ 
    rocket.vx += Math.sin(rocket.yaw)*thrustPower; 
    rocket.vy -= Math.cos(rocket.yaw)*thrustPower; 
    rocket.fuel -= 0.2;
  }

  // Moon gravity
  const dx = width/2 - rocket.x;
  const dy = 100 - rocket.y;
  const dist = Math.sqrt(dx*dx + dy*dy);
  const gForce = gravity*100/(dist*dist+1);
  rocket.vx += dx/dist * gForce;
  rocket.vy += dy/dist * gForce;

  rocket.x += rocket.vx;
  rocket.y += rocket.vy;

  // Rocket transform
  rocketGroup.setAttribute("transform",`translate(${rocket.x},${rocket.y}) rotate(${rocket.yaw*180/Math.PI})`);

  // Flames
  flames.forEach(f=>{
    const fx = rocket.x + (Math.random()*10-5);
    const fy = rocket.y + 20 + Math.random()*10;
    f.setAttribute("cx",fx);
    f.setAttribute("cy",fy);
    f.setAttribute("r",Math.random()*3+1);
    f.setAttribute("fill",rocket.thrusting?"yellow":"orange");
  });

  // Trail
  trail.push({x:rocket.x, y:rocket.y});
  if(trail.length>200) trail.shift();
  trail.forEach((t,i)=>{
    let dot = create("circle",{cx:t.x, cy:t.y, r:0.5, fill:"white", opacity:i/trail.length});
  });

  // Orbit detection
  if(dist>90 && dist<150 && Math.abs(rocket.vx)<3 && Math.abs(rocket.vy)<3){
    document.getElementById("message").innerText = `üåï Orbiting Moon! Fuel: ${rocket.fuel.toFixed(0)}%`;
  }

  // Crash detection
  if(dist<80){
    document.getElementById("message").innerText="üí• Crashed on Moon!";
    return;
  }
  if(rocket.y>height || rocket.x<0 || rocket.x>width){
    document.getElementById("message").innerText="üí• Rocket left bounds!";
    return;
  }
  if(rocket.fuel<=0 && rocket.thrusting){
    document.getElementById("message").innerText="‚ö†Ô∏è Out of fuel!";
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
