<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rave Laser Show</title>
  <style>
    :root{
      --bg:#04040a;
      --panel-bg: rgba(255,255,255,0.04);
      --accent: #00f6ff;
      --ui-radius:12px;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:white;overflow:hidden}
    canvas{display:block;width:100vw;height:100vh}
    .ui{
      position:fixed;left:18px;top:18px;backdrop-filter: blur(6px) saturate(1.2);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:var(--ui-radius);padding:12px 14px;box-shadow:0 6px 30px rgba(0,0,0,0.6);
      max-width:340px;z-index:10;font-size:13px
    }
    .ui h1{margin:0 0 8px 0;font-size:14px;letter-spacing:0.6px}
    .row{display:flex;gap:8px;align-items:center;margin:8px 0}
    .row label{min-width:74px;opacity:0.9}
    input[type=range]{flex:1}
    select,input[type=color]{background:transparent;border:1px solid rgba(255,255,255,0.06);color:white;padding:6px;border-radius:8px}
    button{background:var(--panel-bg);border:1px solid rgba(255,255,255,0.06);color:white;padding:8px 10px;border-radius:10px;cursor:pointer}
    .small{font-size:12px;opacity:0.85}
    .credits{position:fixed;right:18px;bottom:18px;color:rgba(255,255,255,0.6);font-size:12px}
    .fullscreen-btn{position:fixed;right:18px;top:18px}
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <div class="ui" id="controls">
    <h1>Rave Laser Show</h1>
    <div class="row"><label>BPM</label><input id="bpm" type="range" min="40" max="240" value="120"><div class="small" id="bpmVal">120</div></div>
    <div class="row"><label>Beams</label><input id="count" type="range" min="3" max="60" value="18"><div class="small" id="countVal">18</div></div>
    <div class="row"><label>Speed</label><input id="speed" type="range" min="0" max="2" step="0.01" value="0.9"><div class="small" id="speedVal">0.90</div></div>
    <div class="row"><label>Spread</label><input id="spread" type="range" min="0" max="1.2" step="0.01" value="0.6"><div class="small" id="spreadVal">0.60</div></div>
    <div class="row"><label>Palette</label>
      <select id="palette">
        <option value="neon">Neon (Cyan/Magenta)</option>
        <option value="uv">UV (Purple/Blue)</option>
        <option value="warm">Warm (Orange/Hot Pink)</option>
        <option value="rainbow">Rainbow</option>
      </select>
    </div>
    <div class="row"><label>Glow</label><input id="glow" type="range" min="0" max="30" value="14"><div class="small" id="glowVal">14</div></div>
    <div class="row"><label>Blend</label><input id="blend" type="range" min="0" max="1" step="0.01" value="0.85"><div class="small" id="blendVal">0.85</div></div>
    <div class="row"><label></label><button id="randomize">Randomize</button><button id="toggleAudio">Play Audio</button></div>
    <div class="row small"><label>Hint</label><div>Click / drag on canvas to interact. Press <kbd>F</kbd> for fullscreen.</div></div>
  </div>

  <div class="credits">Made for you — tweak the knobs ✨</div>

  <script>
  // Rave Laser Show - single file
  (()=>{
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let w=0,h=0,ratio=1;
    function resize(){
      ratio = Math.min(devicePixelRatio||1,2);
      w = canvas.clientWidth = innerWidth; h = canvas.clientHeight = innerHeight;
      canvas.width = Math.round(w*ratio); canvas.height = Math.round(h*ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
    }
    addEventListener('resize',resize); resize();

    // Controls
    const UI = {
      bpm: document.getElementById('bpm'),
      bpmVal: document.getElementById('bpmVal'),
      count: document.getElementById('count'),
      countVal: document.getElementById('countVal'),
      speed: document.getElementById('speed'), speedVal: document.getElementById('speedVal'),
      spread: document.getElementById('spread'), spreadVal: document.getElementById('spreadVal'),
      palette: document.getElementById('palette'),
      glow: document.getElementById('glow'), glowVal: document.getElementById('glowVal'),
      blend: document.getElementById('blend'), blendVal: document.getElementById('blendVal'),
      randomize: document.getElementById('randomize'), toggleAudio: document.getElementById('toggleAudio')
    };
    Object.values(UI).forEach(el=>{ if(el && el.addEventListener) el.addEventListener('input',updateUI)});
    function updateUI(){
      UI.bpmVal.textContent = UI.bpm.value;
      UI.countVal.textContent = UI.count.value;
      UI.speedVal.textContent = parseFloat(UI.speed.value).toFixed(2);
      UI.spreadVal.textContent = parseFloat(UI.spread.value).toFixed(2);
      UI.glowVal.textContent = UI.glow.value;
      UI.blendVal.textContent = parseFloat(UI.blend.value).toFixed(2);
      resetBeams();
    }

    // Beam generation
    let beams = [];
    function rand(min,max){return Math.random()*(max-min)+min}
    function pickPalette(name,i,t){
      if(name==='neon'){
        const a = ['#00f6ff','#ff00e1'];
        return i%2? a[0] : a[1];
      } else if(name==='uv'){
        const a = ['#8a2be2','#2bdcff']; return a[i%2];
      } else if(name==='warm'){
        const a=['#ff7a18','#ff2d95']; return a[i%2];
      } else if(name==='rainbow'){
        const rainbow = ['#ff3b30','#ff9500','#ffd60a','#32d74b','#0a84ff','#5e5ce6','#ff2d95'];
        return rainbow[Math.floor(t*rainbow.length)%rainbow.length];
      }
      return '#fff';
    }
    function resetBeams(){
      beams = [];
      const n = Math.max(3,Math.floor(parseInt(UI.count.value)));
      for(let i=0;i<n;i++){
        beams.push({
          angle: rand(0,Math.PI*2),
          length: rand(Math.min(w,h)*0.3, Math.max(w,h)*0.9),
          speed: rand(0.2,1.2)*parseFloat(UI.speed.value),
          width: rand(1.2,3.6),
          offset: rand(-0.6,0.6),
          phase: rand(0,Math.PI*2),
          colorSeed: Math.random()
        });
      }
    }
    resetBeams();

    // Interaction
    let mouse = {x:0,y:0,dx:0,dy:0,down:false};
    canvas.addEventListener('pointermove',e=>{const r=canvas.getBoundingClientRect(); mouse.x=(e.clientX-r.left); mouse.y=(e.clientY-r.top);});
    canvas.addEventListener('pointerdown',e=>{mouse.down=true});
    window.addEventListener('pointerup',()=>{mouse.down=false});

    // Audio (simple synth) — requires gesture to start
    let audioCtx=null,osc=null,gainNode=null;
    function toggleAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        osc = audioCtx.createOscillator();
        gainNode = audioCtx.createGain();
        osc.type = 'sawtooth'; osc.frequency.value = 110;
        gainNode.gain.value = 0;
        osc.connect(gainNode); gainNode.connect(audioCtx.destination);
        osc.start();
        UI.toggleAudio.textContent = 'Audio On';
      } else {
        audioCtx.close(); audioCtx=null; osc=null; gainNode=null; UI.toggleAudio.textContent='Play Audio';
      }
    }
    UI.toggleAudio.addEventListener('click',()=>{try{toggleAudio()}catch(e){console.warn(e)}});

    // Randomize button
    UI.randomize.addEventListener('click',()=>{
      UI.palette.value = ['neon','uv','warm','rainbow'][Math.floor(Math.random()*4)];
      UI.count.value = Math.floor(rand(8,48));
      UI.bpm.value = Math.floor(rand(60,160));
      UI.speed.value = (rand(0.4,1.6)).toFixed(2);
      updateUI();
    });

    // Draw loop
    let t0 = performance.now();
    function draw(now){
      const dt = (now - t0)/1000; t0 = now;
      // subtle fade for trails
      ctx.save();
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = `rgba(4,4,10,${1-parseFloat(UI.blend.value)})`;
      ctx.fillRect(0,0,w,h);
      ctx.restore();

      // beat influence
      const bpm = parseFloat(UI.bpm.value);
      const beat = Math.sin(now/1000 * bpm/60 * Math.PI*2) * 0.5 + 0.5; // 0..1
      if(gainNode) gainNode.gain.value = 0.02 + beat*0.08;

      // draw beams
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      const spread = parseFloat(UI.spread.value);
      const glow = parseFloat(UI.glow.value);
      beams.forEach((b,i)=>{
        // evolve
        b.phase += dt*b.speed*0.8;
        b.angle += Math.sin(b.phase*0.25 + i)*0.002 * (mouse.down?2:1);
        const centerX = w*0.5 + Math.sin(b.phase*0.5 + b.offset*5 + i)* (w*0.35 + mouse.x-w*0.5)*0.002;
        const centerY = h*0.5 + Math.cos(b.phase*0.4 + i)* (h*0.35 + mouse.y-h*0.5)*0.002;

        // flicker length
        const len = b.length * (0.75 + 0.25*Math.sin(b.phase*1.3 + i));
        const a = b.angle + Math.sin(now*0.001*(0.2+i%3))*spread;
        const x2 = centerX + Math.cos(a) * len;
        const y2 = centerY + Math.sin(a) * len;

        // color
        const col = pickPalette(UI.palette.value,i,(now/1000 + b.colorSeed));

        // glow pass (additive)
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        for(let g=glow;g>0;g-=3){
          ctx.lineWidth = b.width*(g/6);
          ctx.strokeStyle = hexToRgba(col, (0.12*(g/6))*(0.8+beat*0.6));
          ctx.beginPath(); ctx.moveTo(centerX,centerY); ctx.lineTo(x2,y2); ctx.stroke();
        }
        ctx.restore();

        // core
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        ctx.lineWidth = b.width;
        ctx.strokeStyle = hexToRgba(col, 0.9);
        ctx.beginPath(); ctx.moveTo(centerX,centerY); ctx.lineTo(x2,y2); ctx.stroke();
        ctx.restore();

        // laser tip - bright
        ctx.save(); ctx.globalCompositeOperation='lighter';
        ctx.fillStyle = hexToRgba('#ffffff',0.7);
        ctx.beginPath(); ctx.arc(x2,y2, b.width*1.2 + beat*3,0,Math.PI*2); ctx.fill();
        ctx.restore();
      });

      requestAnimationFrame(draw);
    }
    function hexToRgba(hex,a){
      const c = hex.replace('#','');
      const bigint = parseInt(c,16);
      const r = (bigint>>16)&255; const g=(bigint>>8)&255; const b=(bigint)&255;
      return `rgba(${r},${g},${b},${a})`;
    }

    // keyboard
    window.addEventListener('keydown',e=>{if(e.key==='f' || e.key==='F'){toggleFull()} });
    function toggleFull(){
      if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
      else document.exitFullscreen();
    }

    // start
    updateUI();
    requestAnimationFrame(draw);

    // small performance: adapt beam count to size changes
    let lastSize = {w:innerWidth,h:innerHeight};
    setInterval(()=>{
      if(innerWidth!==lastSize.w || innerHeight!==lastSize.h){ resize(); resetBeams(); lastSize={w:innerWidth,h:innerHeight}; }
    },250);

    // touch + drag affects beams
    let last = {x:0,y:0};
    setInterval(()=>{
      mouse.dx = mouse.x - last.x; mouse.dy = mouse.y - last.y; last.x=mouse.x; last.y=mouse.y;
      // nudge beams based on pointer
      beams.forEach((b,i)=>{
        const d = Math.hypot(mouse.x - w/2, mouse.y - h/2)/Math.hypot(w,h);
        b.angle += mouse.dx*0.0006*(1+ b.offset);
        b.phase += mouse.dy*0.001*(1+ b.offset);
      });
    },40);

  })();
  </script>
</body>
</html>
