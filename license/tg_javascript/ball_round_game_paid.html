<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Circular Pong</title>
<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const center = { x: canvas.width / 2, y: canvas.height / 2 };
const radius = Math.min(canvas.width, canvas.height) / 3;

let paddleAngle = Math.PI / 2;
const paddleArc = Math.PI / 6;
let ball = {
  x: center.x + radius * Math.cos(Math.PI),
  y: center.y + radius * Math.sin(Math.PI),
  vx: 2,
  vy: 1,
  speed: 2
};

let mouse = { x: 0, y: 0 };

// Game state
let score = 0;
let lives = 3;
let missed = false; // flag to track missed paddle

// Neon trail effect
const trails = [];

window.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

function updatePaddle() {
  paddleAngle = Math.atan2(mouse.y - center.y, mouse.x - center.x);
}

function updateBall() {
  ball.x += ball.vx;
  ball.y += ball.vy;

  const dx = ball.x - center.x;
  const dy = ball.y - center.y;
  const dist = Math.sqrt(dx*dx + dy*dy);

  if (dist >= radius) {
    const angleToBall = Math.atan2(dy, dx);
    let angleDiff = ((angleToBall - paddleAngle + Math.PI*2) % (Math.PI*2));
    if (angleDiff > Math.PI) angleDiff -= Math.PI*2;

    if (angleDiff > -paddleArc/2 && angleDiff < paddleArc/2) {
      // Paddle hit
      const normalX = dx / dist;
      const normalY = dy / dist;
      const dot = ball.vx * normalX + ball.vy * normalY;
      ball.vx -= 2 * dot * normalX;
      ball.vy -= 2 * dot * normalY;

      // Spin effect
      const spin = angleDiff * 3; 
      ball.vx += -spin * normalY;
      ball.vy += spin * normalX;

      ball.vx *= 2.02;
      ball.vy *= 2.02;

      score++;
      missed = false; // reset missed flag
    } else {
      // Missed paddle: only decrease lives once per miss
      if (!missed) {
        lives--;
        missed = true;
        if (lives <= 0) {
          lives = 3;
          score = 0;
        }
      }
      // Reset ball
      ball.x = center.x + radius * Math.cos(Math.PI);
      ball.y = center.y + radius * Math.sin(Math.PI);
      ball.vx = 2;
      ball.vy = 1;
    }
  }

  // Trail effect
  trails.push({ x: ball.x, y: ball.y, alpha: 1 });
  for (let t of trails) t.alpha -= 0.02;
  while(trails.length && trails[0].alpha <= 0) trails.shift();
}

function drawCircle() {
  ctx.beginPath();
  ctx.strokeStyle = "#444";
  ctx.lineWidth = 2;
  ctx.arc(center.x, center.y, radius, 0, Math.PI*2);
  ctx.stroke();
}

function drawPaddle() {
  ctx.beginPath();
  const gradient = ctx.createLinearGradient(
    center.x + radius * Math.cos(paddleAngle),
    center.y + radius * Math.sin(paddleAngle),
    center.x + radius * Math.cos(paddleAngle + paddleArc),
    center.y + radius * Math.sin(paddleAngle + paddleArc)
  );
  gradient.addColorStop(0, "#0ff");
  gradient.addColorStop(1, "#f0f");
  ctx.strokeStyle = gradient;
  ctx.lineWidth = 12;
  ctx.shadowColor = "#0ff";
  ctx.shadowBlur = 15;
  ctx.arc(center.x, center.y, radius, paddleAngle - paddleArc/2, paddleAngle + paddleArc/2);
  ctx.stroke();
  ctx.shadowBlur = 0;
}

function drawBall() {
  // Draw trails
  for (let t of trails) {
    ctx.beginPath();
    ctx.fillStyle = `rgba(0,255,0,${t.alpha})`;
    ctx.arc(t.x, t.y, 12, 0, Math.PI*2);
    ctx.fill();
  }

  // Draw ball
  ctx.beginPath();
  ctx.fillStyle = "#00FF00"; // neon green
  ctx.shadowColor = "#00FF00";
  ctx.shadowBlur = 20;
  ctx.arc(ball.x, ball.y, 10, 0, Math.PI*2);
  ctx.fill();
  ctx.shadowBlur = 0;
}

function drawHUD() {
  ctx.fillStyle = "white";
  ctx.font = "24px Arial";
  ctx.fillText("Score: " + score, 20, 30);
  ctx.fillText("Lives: " + lives, 20, 60);
}

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawCircle();
  updatePaddle();
  drawPaddle();
  updateBall();
  drawBall();
  drawHUD();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
