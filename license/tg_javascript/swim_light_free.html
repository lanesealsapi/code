<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Particle swim-light</title>
  <style>
    html,body{height:100%;margin:0;background:#050508;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    canvas{display:block}
    .ui{
      position:fixed;right:16px;top:16px;display:flex;flex-direction:column;gap:8px;z-index:10;
      background:rgba(0,0,0,0.25);backdrop-filter:blur(6px);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)
    }
    .row{display:flex;gap:8px}
    button{appearance:none;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
    .toggle{background:linear-gradient(180deg,#111,#000);color:#fff}
    .color-btn{width:36px;height:36px;padding:0;border-radius:8px}
    .small{font-size:12px;padding:6px}
    .label{color:#ddd;font-size:12px;margin-bottom:4px;text-align:center}
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="ui" aria-hidden="false">
    <div class="label">Torch â€¢ Space to pause</div>
    <div class="row">
      <button id="toggle" class="toggle">ON</button>
      <button id="clear" class="small">Clear</button>
    </div>
    <div style="margin-top:6px" class="label">Colors (Click)</div>
    <div class="row">
      <button class="color-btn" data-color="#ff3b30" style="background:#ff3b30" title="Red"></button>
      <button class="color-btn" data-color="#ff9500" style="background:#ff9500" title="Orange"></button>
      <button class="color-btn" data-color="#ffd60a" style="background:#ffd60a" title="Yellow"></button>
      <button class="color-btn" data-color="#34c759" style="background:#34c759" title="Green"></button>
      <button class="color-btn" data-color="#0a84ff" style="background:#0a84ff" title="Blue"></button>
      <button class="color-btn" data-color="#af52de" style="background:#af52de" title="Purple"></button>
      <button class="color-btn" data-color="#ffffff" style="background:#fff;border:1px solid #ddd" title="White"></button>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
      <div class="label" style="margin:0">Intensity</div>
      <input id="intensity" type="range" min="0" max="2" step="0.01" value="1" style="width:110px">
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  let DPR = Math.max(1, window.devicePixelRatio || 1);
  function resize(){
    DPR = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = Math.floor(window.innerWidth * DPR);
    canvas.height = Math.floor(window.innerHeight * DPR);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  const MAX_PARTICLES = 800;
  const particles = new Array(MAX_PARTICLES);
  let poolIndex = 0;

  class P {
    constructor(){ this.reset(); }
    reset(){ this.x=0;this.y=0;this.vx=0;this.vy=0;this.life=0;this.ttl=0;this.size=0;this.color='#fff';this.alive=false; }
    init(x,y,vx,vy,ttl,size,color){ this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.ttl=ttl;this.life=0;this.size=size;this.color=color;this.alive=true; }
    step(dt){ this.x+=this.vx*dt;this.y+=this.vy*dt;this.vx*=0.99;this.vy*=0.99;this.life+=dt;if(this.life>=this.ttl)this.alive=false; }
  }
  for(let i=0;i<MAX_PARTICLES;i++) particles[i]=new P();

  function spawn(x,y,color,amount=6){
    for(let i=0;i<amount;i++){
      const p=particles[poolIndex];poolIndex=(poolIndex+1)%MAX_PARTICLES;
      const speed=Math.random()*180+20;const ang=Math.random()*Math.PI*2;
      const vx=Math.cos(ang)*speed;const vy=Math.sin(ang)*speed;
      const ttl=0.35+Math.random()*0.9;const size=6+Math.random()*18;
      p.init(x,y,vx,vy,ttl,size,color);
    }
  }

  let emOn=true;let color='#ff9500';let intensity=1;
  const toggleBtn=document.getElementById('toggle');
  const clearBtn=document.getElementById('clear');
  const colorBtns=document.querySelectorAll('.color-btn');
  const intensityEl=document.getElementById('intensity');

  toggleBtn.addEventListener('click',()=>{emOn=!emOn;toggleBtn.textContent=emOn?'ON':'OFF';toggleBtn.style.opacity=emOn?1:0.6;});
  clearBtn.addEventListener('click',()=>{for(let p of particles)p.reset();});
  colorBtns.forEach(b=>b.addEventListener('click',()=>{color=b.dataset.color;}));
  intensityEl.addEventListener('input',()=>{intensity=parseFloat(intensityEl.value);});

  window.addEventListener('keydown',(e)=>{if(e.code==='Space'){e.preventDefault();emOn=!emOn;toggleBtn.textContent=emOn?'ON':'OFF';}});

  // Gentle chaos dynamics with random pitch/yaw drift
  let pos={x:window.innerWidth/2,y:window.innerHeight/2};
  let v={x:0.3,y:-0.25};
  let z=10;
  const chaos={a:10,b:28,c:8/3};

  function updateChaos(dt){
    const dx = chaos.a*(v.y - v.x)*dt;
    const dy = (v.x*(chaos.b - z) - v.y)*dt;
    const dz = (v.x*v.y - chaos.c*z)*dt;
    v.x += dx*0.3; v.y += dy*0.3; z += dz*0.3;

    // Random pitch/yaw drift for smoother wandering
    v.x += (Math.random()-0.5)*1.12;
    v.y += (Math.random()-0.5)*1.12;

    pos.x += v.x * 1 * dt * 30;
    pos.y += v.y * 1 * dt * 30;

    // Bound within window, reflect softly at edges
    const margin = 30;
    if(pos.x < margin){ pos.x = margin; v.x *= -0.7; }
    if(pos.x > window.innerWidth - margin){ pos.x = window.innerWidth - margin; v.x *= -0.7; }
    if(pos.y < margin){ pos.y = margin; v.y *= -0.7; }
    if(pos.y > window.innerHeight - margin){ pos.y = window.innerHeight - margin; v.y *= -0.7; }
  }

  let last=performance.now();
  function frame(now){
    const dt=Math.min(0.04,(now-last)/1000);last=now;
    updateChaos(dt);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='rgba(4,4,6,0.18)';ctx.fillRect(0,0,canvas.width,canvas.height);

    if(emOn){
      const spawnCount=Math.floor(10*intensity);
      for(let i=0;i<spawnCount;i++){
        const sx=pos.x+(Math.random()-0.5)*24;
        const sy=pos.y+(Math.random()-0.5)*24;
        spawn(sx,sy,color,1);
      }
    }

    ctx.globalCompositeOperation='lighter';
    for(let i=0;i<MAX_PARTICLES;i++){
      const p=particles[i];if(!p.alive)continue;p.step(dt);
      const lifeRatio=1-(p.life/p.ttl);const s=p.size*lifeRatio*(0.6+intensity*0.8);
      const gradient=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,Math.max(1,s*3));
      const ic=colorToRgba(p.color||color,Math.max(0.12,0.35*lifeRatio));
      const oc=colorToRgba(p.color||color,Math.max(0.0,0.02*lifeRatio));
      gradient.addColorStop(0,ic);
      gradient.addColorStop(0.3,colorToRgba(p.color||color,Math.max(0.06,0.15*lifeRatio)));
      gradient.addColorStop(1,oc);
      ctx.fillStyle=gradient;
      ctx.beginPath();ctx.arc(p.x,p.y,Math.max(1,s*3),0,Math.PI*2);ctx.fill();
      ctx.fillStyle=colorToRgba(p.color||color,Math.max(0.12,0.45*lifeRatio));
      ctx.beginPath();ctx.arc(p.x,p.y,Math.max(1,s*0.4),0,Math.PI*2);ctx.fill();
    }
    ctx.globalCompositeOperation='source-over';

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  function colorToRgba(hex,alpha){
    if(!hex)hex='#fff';const m=hex.replace('#','');let r=255,g=255,b=255;
    if(m.length===3){r=parseInt(m[0]+m[0],16);g=parseInt(m[1]+m[1],16);b=parseInt(m[2]+m[2],16);}else{r=parseInt(m.substring(0,2),16);g=parseInt(m.substring(2,4),16);b=parseInt(m.substring(4,6),16);}
    return `rgba(${r},${g},${b},${alpha})`;
  }
})();
</script>
</body>
</html>
