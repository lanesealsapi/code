<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Neon Audio Visualizer</title>
<style>
:root {
  --bg:#05060b;
  --accent:#00fff0;
}
html,body {
  margin:0; height:100%; overflow:hidden;
  background:var(--bg); font-family:sans-serif;
}
canvas {
  width:100vw; height:100vh; display:block;
  background:radial-gradient(circle at center, #05060b 0%, #02040a 100%);
}
.ui {
  position:fixed; top:10px; left:10px;
  display:flex; flex-wrap:wrap; gap:6px;
  background:rgba(255,255,255,0.04);
  padding:8px 10px; border-radius:12px;
  backdrop-filter:blur(6px);
  font-size:12px; color:#d0eaff;
}
select,input[type="color"],input[type="range"],button {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  color:#d0eaff; border-radius:8px;
  padding:4px 6px; font-size:12px;
}
button { cursor:pointer; }
input[type="range"] { width:80px; }
label { opacity:0.8; margin-right:4px; }
small { display:block; opacity:0.5; margin-top:4px; }
</style>
</head>
<body>
<canvas id="cv"></canvas>

<div class="ui">
  <button id="mic">üé§ Mic</button>
  <input type="file" id="file" accept="audio/*">
  <button id="play">‚ñ∂</button>
  <button id="pause">‚è∏</button>
  <label>Mode</label>
  <select id="mode">
    <option>bars</option>
    <option>wave</option>
    <option>particles</option>
    <option>rings</option>
    <option>spectral</option>
  </select>
  <label>Color</label>
  <input type="color" id="color" value="#00fff0">
  <label>Sens</label>
  <input type="range" id="sens" min="0.2" max="4" step="0.1" value="1.2">
  <label>Trail</label>
  <input type="range" id="trail" min="0" max="1" step="0.01" value="0.1">
</div>

<script>
(()=>{
const c=document.getElementById('cv');
const ctx=c.getContext('2d');
let W,H,dpr;
function resize(){
  dpr=window.devicePixelRatio||1;
  W=window.innerWidth; H=window.innerHeight;
  c.width=W*dpr; c.height=H*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize',resize); resize();

// --- Audio Setup ---
const AudioCtx=window.AudioContext||window.webkitAudioContext;
let audioCtx,analyser,src,gain;
let data=new Uint8Array(256),time=new Uint8Array(256);
function makeAnalyser(){
  if(!audioCtx) audioCtx=new AudioCtx();
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=512;
  gain=audioCtx.createGain();
  src && src.connect(gain);
  gain.connect(analyser);
  analyser.connect(audioCtx.destination);
}

// --- Inputs ---
const micBtn=document.getElementById('mic');
const fileIn=document.getElementById('file');
const playBtn=document.getElementById('play');
const pauseBtn=document.getElementById('pause');
micBtn.onclick=async()=>{
  try{
    if(!audioCtx) audioCtx=new AudioCtx();
    const s=await navigator.mediaDevices.getUserMedia({audio:true});
    src=audioCtx.createMediaStreamSource(s);
    makeAnalyser();
  }catch(e){alert('Mic error');}
};
fileIn.onchange=e=>{
  const f=e.target.files[0]; if(!f)return;
  if(!audioCtx) audioCtx=new AudioCtx();
  const el=new Audio(); el.src=URL.createObjectURL(f); el.loop=true;
  el.play(); src=audioCtx.createMediaElementSource(el); makeAnalyser();
};
playBtn.onclick=()=>audioCtx&&audioCtx.resume();
pauseBtn.onclick=()=>audioCtx&&audioCtx.suspend();

// --- Controls ---
const modeSel=document.getElementById('mode');
const colorPick=document.getElementById('color');
const sensIn=document.getElementById('sens');
const trailIn=document.getElementById('trail');

// --- Visual ---
let particles=[];
class P{
  constructor(x,y,vx,vy,s,c){this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.s=s;this.c=c;this.l=1;}
  step(){this.x+=this.vx;this.y+=this.vy;this.vx*=0.98;this.vy*=0.98;this.l-=0.01;}
  draw(){ctx.globalAlpha=this.l;ctx.fillStyle=this.c;ctx.beginPath();ctx.arc(this.x,this.y,this.s,0,Math.PI*2);ctx.fill();}
}

function draw(){
  requestAnimationFrame(draw);
  ctx.fillStyle=`rgba(0,0,0,${trailIn.value})`; ctx.fillRect(0,0,W,H);
  if(!analyser)return;
  analyser.getByteFrequencyData(data);
  analyser.getByteTimeDomainData(time);
  const sens=parseFloat(sensIn.value);
  const col=colorPick.value;
  const rgb=parseInt(col.slice(1),16);
  const r=(rgb>>16)&255,g=(rgb>>8)&255,b=rgb&255;
  const style=`rgb(${r},${g},${b})`;
  const mode=modeSel.value;

  if(mode==='bars'){
    const n=data.length, barW=W/n;
    for(let i=0;i<n;i++){
      const v=data[i]/255;
      const h=v*H*sens*0.7;
      ctx.fillStyle=style;
      ctx.fillRect(i*barW,H-h,barW*0.9,h);
    }
  }
  else if(mode==='wave'){
    ctx.beginPath();
    for(let i=0;i<time.length;i++){
      const v=time[i]/128;
      const y=H/2+(v-1)*H*0.4*sens;
      const x=i/W*time.length*W;
      i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    }
    ctx.strokeStyle=style; ctx.lineWidth=2; ctx.shadowColor=style; ctx.shadowBlur=10;
    ctx.stroke(); ctx.shadowBlur=0;
  }
  else if(mode==='particles'){
    const avg=data.reduce((a,b)=>a+b)/data.length;
    if(avg>50){
      for(let i=0;i<10;i++){
        const a=Math.random()*Math.PI*2;
        const sp=(avg/255)*6;
        particles.push(new P(W/2,H/2,Math.cos(a)*sp,Math.sin(a)*sp,2+Math.random()*3,style));
      }
    }
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.step(); p.draw();
      if(p.l<=0)particles.splice(i,1);
    }
  }
  else if(mode==='rings'){
    const avg=data.reduce((a,b)=>a+b)/data.length;
    const radius=80+avg*sens;
    ctx.beginPath();
    ctx.arc(W/2,H/2,radius,0,Math.PI*2);
    ctx.strokeStyle=style; ctx.lineWidth=2+avg/64; ctx.shadowColor=style; ctx.shadowBlur=20;
    ctx.stroke(); ctx.shadowBlur=0;
  }
  else if(mode==='spectral'){
    const n=data.length;
    for(let i=0;i<n;i++){
      const x=(i/n)*W;
      const v=data[i]/255;
      const y=H*(1-v*sens);
      ctx.strokeStyle=`rgba(${r},${g},${b},${0.8*v})`;
      ctx.beginPath();
      ctx.moveTo(x,H);
      ctx.lineTo(x,y);
      ctx.stroke();
    }
  }
}
draw();
})();
</script>
</body>
</html>
