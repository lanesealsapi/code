<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Particle Word Morph with Color</title>
<style>
  body {
    background: #111;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    margin: 0;
    font-family: sans-serif;
  }
  input, label {
    margin-top: 10px;
    font-size: 20px;
    align: inline;
  }
  input[type="text"] {
    padding: 10px;
    width: 80%;
    max-width: 600px;
    text-align: center;
    font-size: 24px;
    border-radius: 11px;
  }
  canvas {
    margin-top: 20px;
    background: #111;
  }
</style>
</head>
<body>

<label for="colorPicker">project (noun velocity)</label>
<input type="color" id="colorPicker" value="#ef42f5">
<input type="text" id="wordInput" placeholder="Type something..." />
<canvas id="particleCanvas"></canvas>

<script>
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight * 0.7;

let particles = [];
let particleColor = document.getElementById('colorPicker').value;

class Particle {
  constructor(x, y) {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.tx = x;
    this.ty = y;
    this.vx = 0;
    this.vy = 0;
  }
  update() {
    const dx = this.tx - this.x;
    const dy = this.ty - this.y;
    this.vx += dx * 0.1;
    this.vy += dy * 0.1;
    this.vx *= 0.8;
    this.vy *= 0.8;
    this.x += this.vx;
    this.y += this.vy;
  }
  draw() {
    ctx.fillStyle = particleColor;
    ctx.beginPath();
    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
    ctx.fill();
  }
}

function textToParticles(text) {
  const tempCanvas = document.createElement('canvas');
  const tempCtx = tempCanvas.getContext('2d');
  tempCanvas.width = canvas.width;
  tempCanvas.height = canvas.height;
  tempCtx.fillStyle = 'white';
  tempCtx.font = 'bold 120px sans-serif';
  tempCtx.textAlign = 'center';
  tempCtx.textBaseline = 'middle';
  tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
  tempCtx.fillText(text, tempCanvas.width / 2, tempCanvas.height / 2);

  const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height).data;
  let points = [];
  for (let y = 0; y < tempCanvas.height; y += 8) {
    for (let x = 0; x < tempCanvas.width; x += 8) {
      const index = (y * tempCanvas.width + x) * 4;
      if (imageData[index + 3] > 128) {
        points.push({x, y});
      }
    }
  }
  return points;
}

function morphToWord(text) {
  const newPoints = textToParticles(text);
  while (particles.length < newPoints.length) {
    particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height));
  }
  while (particles.length > newPoints.length) {
    particles.pop();
  }
  for (let i = 0; i < particles.length; i++) {
    particles[i].tx = newPoints[i].x;
    particles[i].ty = newPoints[i].y;
  }
}

document.getElementById('wordInput').addEventListener('input', (e) => {
  morphToWord(e.target.value);
});

document.getElementById('colorPicker').addEventListener('input', (e) => {
  particleColor = e.target.value;
});

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    p.update();
    p.draw();
  });
  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
